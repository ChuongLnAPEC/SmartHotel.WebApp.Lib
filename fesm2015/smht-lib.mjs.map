{"version":3,"file":"smht-lib.mjs","sources":["../../../projects/smht-lib/src/lib/services/common-smht.service.ts","../../../projects/smht-lib/src/lib/smht-lib.module.ts","../../../projects/smht-lib/src/smht-lib.ts"],"sourcesContent":["import { HttpClient } from '@angular/common/http';\r\nimport { Inject, Injectable } from '@angular/core';\r\nimport { BehaviorSubject, from, Observable, of } from 'rxjs';\r\nimport { switchMap, tap } from 'rxjs/operators';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class CommonSmhtService {\r\n  private systemDateSubject = new BehaviorSubject<Date | null>(null);\r\n  public systemDate$: Observable<Date> = this.systemDateSubject.asObservable().pipe(\r\n    switchMap((date) => {\r\n      if (date === null) {\r\n        return this.getDate().pipe(\r\n          tap(fetchedDate => this.systemDateSubject.next(this.modifyDateByUTC(new Date(fetchedDate.dataResult), true)))\r\n        );\r\n      } else {\r\n        return of(date);\r\n      }\r\n    })\r\n  );\r\n\r\n  private showLoadingSubject = new BehaviorSubject<boolean>(false);\r\n  showLoadingObservable = this.showLoadingSubject.asObservable();\r\n\r\n  private messageSocketSubject = new BehaviorSubject<any>(null);\r\n  public messageSocket$: Observable<any> = this.messageSocketSubject.asObservable();\r\n\r\n  private languageSubject = new BehaviorSubject<string>(localStorage.getItem('language') || 'en');\r\n  public language$: Observable<string> = this.languageSubject.asObservable();\r\n\r\n  constructor(\r\n    private httpClient: HttpClient,\r\n    @Inject('env') private env: any\r\n  ) {\r\n  }\r\n\r\n  getApiUrl(): string {\r\n    return this.env?.apis.default?.url\r\n  }\r\n  setLanguage(lang: string) {\r\n    this.languageSubject.next(lang);\r\n  }\r\n  showLoading(isLoading: boolean) {\r\n    this.showLoadingSubject.next(isLoading);\r\n  }\r\n\r\n  getDate(): Observable<any> {\r\n    return this.httpClient.get(this.getApiUrl() + '/api/sys/getWorkingDate');\r\n  }\r\n\r\n  updateSystemDate(): void {\r\n    this.getDate().pipe(\r\n      tap(fetchedDate => this.systemDateSubject.next(this.modifyDateByUTC(new Date(fetchedDate.dataResult), true)))\r\n    ).subscribe();\r\n  }\r\n\r\n  modifyDateByUTC(date: any, isGetMethod: boolean) {\r\n    const localUTC = (new Date().getTimezoneOffset() / 60);\r\n    const data = new Date(date);\r\n    data.setHours(data.getHours() + (!isGetMethod ? -localUTC : localUTC));\r\n    return data;\r\n  }\r\n\r\n  getMessageSocket(data: any) {\r\n    this.messageSocketSubject.next(data);\r\n  }\r\n}\r\n","import { ModuleWithProviders, NgModule } from '@angular/core';\r\nimport { CommonSmhtService } from './services/common-smht.service';\r\n\r\n\r\n\r\n@NgModule({\r\n  declarations: [\r\n    \r\n  ],\r\n  imports: [\r\n\r\n  ],\r\n  exports: [\r\n  ]\r\n})\r\nexport class SmhtLibModule {\r\n  static forRoot(environment: any): ModuleWithProviders<SmhtLibModule> {\r\n    return {\r\n      ngModule: SmhtLibModule,\r\n      providers: [\r\n        {\r\n          provide: 'env',\r\n          useValue: environment,\r\n        },\r\n        CommonSmhtService\r\n      ],\r\n    };\r\n  }\r\n}\r\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":"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"}