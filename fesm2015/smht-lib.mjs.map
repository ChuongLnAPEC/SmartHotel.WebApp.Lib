{"version":3,"file":"smht-lib.mjs","sources":["../../../projects/smht-lib/src/lib/services/common-smht.service.ts","../../../projects/smht-lib/src/smht-lib.ts"],"sourcesContent":["import { HttpClient } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { BehaviorSubject, from, Observable, of } from 'rxjs';\r\nimport { switchMap, tap } from 'rxjs/operators';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class CommonSmhtService {\r\n  private api = 'https://api-gateway-test.apecgroup.net/shmv2/fo'\r\n  private systemDateSubject = new BehaviorSubject<Date | null>(null);\r\n  public systemDate$: Observable<Date> = this.systemDateSubject.asObservable().pipe(\r\n    switchMap((date) => {\r\n      if (date === null) {\r\n        return this.getDate().pipe(\r\n          tap(fetchedDate => this.systemDateSubject.next(this.modifyDateByUTC(fetchedDate.dataResult, true)))\r\n        );\r\n      } else {\r\n        return of(this.modifyDateByUTC(date, true));\r\n      }\r\n    })\r\n  );\r\n\r\n  private showLoadingSubject = new BehaviorSubject<boolean>(false);\r\n  showLoadingObservable = this.showLoadingSubject.asObservable();\r\n\r\n  showLoading(isLoading: boolean) {\r\n    this.showLoadingSubject.next(isLoading);\r\n  }\r\n\r\n  constructor(\r\n    private httpClient: HttpClient\r\n  ) {\r\n  }\r\n  getDate(): Observable<any> {\r\n    return this.httpClient.get(this.api + '/api/sys/getWorkingDate');\r\n  }\r\n\r\n  updateSystemDate(): void {\r\n    this.getDate().pipe(\r\n      tap(fetchedDate => this.systemDateSubject.next(fetchedDate.dataResult))\r\n    ).subscribe();\r\n  }\r\n\r\n  modifyDateByUTC(date: any, isGetMethod: boolean) {\r\n    const localUTC = (new Date().getTimezoneOffset() / 60);\r\n    const data = new Date(date);\r\n    data.setHours(data.getHours() + (!isGetMethod ? -localUTC : localUTC));\r\n    return data;\r\n  }\r\n}\r\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":";;;;;;MAQa,iBAAiB,CAAA;AAsB5B,IAAA,WAAA,CACU,UAAsB,EAAA;AAAtB,QAAA,IAAU,CAAA,UAAA,GAAV,UAAU,CAAY;AAtBxB,QAAA,IAAG,CAAA,GAAA,GAAG,iDAAiD,CAAA;QACvD,IAAA,CAAA,iBAAiB,GAAG,IAAI,eAAe,CAAc,IAAI,CAAC,CAAC;AAC5D,QAAA,IAAA,CAAA,WAAW,GAAqB,IAAI,CAAC,iBAAiB,CAAC,YAAY,EAAE,CAAC,IAAI,CAC/E,SAAS,CAAC,CAAC,IAAI,KAAI;YACjB,IAAI,IAAI,KAAK,IAAI,EAAE;AACjB,gBAAA,OAAO,IAAI,CAAC,OAAO,EAAE,CAAC,IAAI,CACxB,GAAG,CAAC,WAAW,IAAI,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,IAAI,CAAC,eAAe,CAAC,WAAW,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC,CAAC,CACpG,CAAC;AACH,aAAA;AAAM,iBAAA;gBACL,OAAO,EAAE,CAAC,IAAI,CAAC,eAAe,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC,CAAC;AAC7C,aAAA;SACF,CAAC,CACH,CAAC;QAEM,IAAA,CAAA,kBAAkB,GAAG,IAAI,eAAe,CAAU,KAAK,CAAC,CAAC;QACjE,IAAA,CAAA,qBAAqB,GAAG,IAAI,CAAC,kBAAkB,CAAC,YAAY,EAAE,CAAC;KAS9D;AAPD,IAAA,WAAW,CAAC,SAAkB,EAAA;AAC5B,QAAA,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;KACzC;IAMD,OAAO,GAAA;AACL,QAAA,OAAO,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,GAAG,yBAAyB,CAAC,CAAC;KAClE;IAED,gBAAgB,GAAA;QACd,IAAI,CAAC,OAAO,EAAE,CAAC,IAAI,CACjB,GAAG,CAAC,WAAW,IAAI,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,WAAW,CAAC,UAAU,CAAC,CAAC,CACxE,CAAC,SAAS,EAAE,CAAC;KACf;IAED,eAAe,CAAC,IAAS,EAAE,WAAoB,EAAA;AAC7C,QAAA,MAAM,QAAQ,IAAI,IAAI,IAAI,EAAE,CAAC,iBAAiB,EAAE,GAAG,EAAE,CAAC,CAAC;AACvD,QAAA,MAAM,IAAI,GAAG,IAAI,IAAI,CAAC,IAAI,CAAC,CAAC;QAC5B,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,WAAW,GAAG,CAAC,QAAQ,GAAG,QAAQ,CAAC,CAAC,CAAC;AACvE,QAAA,OAAO,IAAI,CAAC;KACb;;8GAzCU,iBAAiB,EAAA,IAAA,EAAA,CAAA,EAAA,KAAA,EAAA,EAAA,CAAA,UAAA,EAAA,CAAA,EAAA,MAAA,EAAA,EAAA,CAAA,eAAA,CAAA,UAAA,EAAA,CAAA,CAAA;AAAjB,iBAAA,CAAA,KAAA,GAAA,EAAA,CAAA,qBAAA,CAAA,EAAA,UAAA,EAAA,QAAA,EAAA,OAAA,EAAA,QAAA,EAAA,QAAA,EAAA,EAAA,EAAA,IAAA,EAAA,iBAAiB,cAFhB,MAAM,EAAA,CAAA,CAAA;2FAEP,iBAAiB,EAAA,UAAA,EAAA,CAAA;kBAH7B,UAAU;AAAC,YAAA,IAAA,EAAA,CAAA;AACV,oBAAA,UAAU,EAAE,MAAM;iBACnB,CAAA;;;ACPD;;AAEG;;;;"}